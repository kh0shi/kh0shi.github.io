<!DOCTYPE html>
<html lang="en">
<head>
        <title>وبلاگِ خوشی - لینوکس</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/None" type="application/atom+xml" rel="alternate" title="وبلاگِ خوشی ATOM Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body>
        
        

            <header>
                <h1><a href="" id="site-title">وبلاگِ خوشی </a> : <a href="/colorized-ssh.html" id="page-title">ترمینال‌های رنگی</a></h1>
<time datetime="2022-02-22T00:00:00+03:30">سه شنبه 03 اسفند 1400</time>            </header>

            <article>
                <p>من خیلی از اوقات مجبورم هم‌زمان با سرورهای مختلفی کار کنم و ترمینال‌های متعددی برای ssh زدن به هر کدام باز کنم. گاهی اوقات آن‌ها را با هم اشتباه می‌گیرم و پیش آمده که به جای سرور دولوپ، سرور پروداکشن را ری‌استارت کنم. حتما راه‌حل‌های مختلفی برای حل این مشکل هست. کاری که من کردم این بود:</p>
<p>برای هر کدام از سرورها، رنگی مشخص کردم و کاری کردم که وقتی به آن سرور وصل می‌شوم، ترمینال با رنگ خودش باز شود. در این صورت دیگر کمتر سرور آبی را با سرور قرمز اشتباه می‌گیرم!</p>
<p>مراحل اجرای این کار در اوبونتو از این قرار است:</p>
<ol>
<li>ساختن کلید احراز هویت ssh و کپی کردنش تو سرورها</li>
<li>ذخیره یوزر و آدرس سرورها در کانفیگ ssh</li>
<li>ایجاد پروفایل‌های مختلف در تنظیمات GNOME Terminal</li>
<li>نوشتن alias برای دستور ssh</li>
<li>و یک تغییر اضافه برای تیماکسی‌ها</li>
</ol>
<p>مرحله ۱ و ۲ را فقط برای این که این لیست کامل باشد نوشتم.</p>
<h3>۳. ایجاد پروفایل‌های مختلف در تنظیمات GNOME Terminal</h3>
<p>من از ترمینال پیش‌فرض اوبونتو استفاده می‌کنم. در تنظیمات آن می‌توان پروفایل‌های متفاوتی ایجاد کرد. همیشه برایم سوال بود که این پروفایل‌ها به چه کار می‌آیند که به جواب سوالم رسیدم.
در Prefrences، پروفایل‌های جدیدی ایجاد کنید و نام پروفایل را برابر با نامی که در مرحله قبل برای هر سرور انتخاب کرده‌اید قرار دهید. بعد از ایجاد پروفایل، روی نامش کلیک کنید و در تب Colors، تیک گزینهٔ <em>Use colors from system theme</em> را بردارید و رنگ دلخواه خود را تعیین کنید.</p>
<h3>۴. نوشتن alias برای دستور ssh</h3>
<p>متن زیر را متناسب با بش‌تان در zshrc. یا bashrc. یا هر جای دیگر که لازم است قرار دهید.</p>
<div class="highlight"><pre><span></span><code><span class="nv">custom_ssh</span> <span class="ss">()</span> {
  <span class="k">if</span> [[ <span class="s2">&quot;</span><span class="s">$1</span><span class="s2">&quot;</span> <span class="o">=~</span> <span class="o">^</span><span class="ss">(</span><span class="nv">dev</span><span class="o">|</span><span class="nv">api</span><span class="ss">)</span>$ ]]<span class="c1">; then</span>
    <span class="nv">gnome</span><span class="o">-</span><span class="nv">terminal</span> <span class="o">--</span><span class="nv">window</span><span class="o">-</span><span class="nv">with</span><span class="o">-</span><span class="nv">profile</span> <span class="mh">$1</span> <span class="o">--</span> <span class="nv">ssh</span> <span class="mh">$1</span>
  <span class="k">else</span>
    <span class="nv">ssh</span> <span class="mh">$1</span>
  <span class="nv">fi</span>
}
<span class="nv">alias</span> <span class="nv">ssh</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">custom_ssh</span><span class="s1">&#39;</span>
</code></pre></div>

<p>نام سرور و پروفایلی که من انتخاب کرده بودم، dev و api بود. هر نامی که در دو مرحلهٔ قبل تعیین کردید را با این‌ها جایگزین کنید و اگر بیشتر هستند، با "|" از هم جدایشان کنید و در همان جا بنویسید.
اجرای "source .bashrc" را بعد از ذخیره کردنش فراموش نکنید.
این هم از نتیجهٔ کار:</p>
<p><img alt="ssh" src="../images/ssh.gif"></p>
<p>اگر بخواهید، می‌توانید برای ssh به سرورهای جدید هم پروفایلی بسازید تا با سیستم خودتان اشتباه‌شان نگیرید. من اسم این پروفایل را گذاشته‌ام "ssh". کافی است "ssh $1" که بعد از else آمده را با این جایگزین کنید:</p>
<div class="highlight"><pre><span></span><code>gnome-terminal --window-with-profile ssh -- ssh $1
</code></pre></div>

<h3>۵. یک تغییر اضافه برای تیماکسی‌ها</h3>
<p>من برای کار بر روی سیستم‌های ریموت از تیماکس استفاده می‌کنم. به صورتی که معمولا یک سشن به نام من روی آن سرور هست و پنجره‌های مختلفی روی آن باز است. این جا نمی‌خواهم از قابلیت‌های tmux بگویم. با این تغییر، بعد از اتصال به سرور، مستقیم به سشن مورد نظر وصل می‌شوم و یا اگر سشنی با آن نام وجود نداشته باشد، ساخته می‌شود. بدیهی است که از قبل باید tmux روی سرور نصب باشد.
برای این کار کافی است به جای</p>
<div class="highlight"><pre><span></span><code>gnome-terminal --window-with-profile $1 -- ssh $1
</code></pre></div>

<p>این را جایگزین کنید:</p>
<div class="highlight"><pre><span></span><code> gnome-terminal --window-with-profile $1 -- ssh $1 -t &#39;tmux a -t khoshi || tmux new -s khoshi&#39;
</code></pre></div>

<p>تغییرات دیگری هم برای اتصال به vpn قبل از ssh به سرور (معمولا vpnهای سازمانی) هست که باشد برای بعد. در مورد دردسرهایم با vpnها و راه‌حل‌هایشان باید جداگانه توضیح دهم.</p>            </article>
            <hr>        
<nav>
    <ul>
    </ul>
</nav>

        <footer>
                <a href="">وبلاگ شخصی محمدحسین خوش‌مهر</a>
                <div id="theme-credit">based on <a href="http://mathieu.agopian.info/mnmlist/theme.html">Thème mnmlist</a></div>
        </footer>
</body>
</html>